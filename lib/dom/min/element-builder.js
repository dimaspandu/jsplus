/**
 * @license JS+ (DOM) v1.0.0
 * jsplus/element-builder.js
 *
 * Copyright (c) dimaspandu
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
*/ !function(t){"use strict";var e={},n={autofocus:!0,disabled:!0,selected:!0,multiple:!0,recorded:!0},r={0:!1,1:!0,false:!1,true:!0},i=function(t,n){e[t]={instance:n,iteration:0}},o=function(t,n){n(e[t])},s=function(t){return e[t]},d=function(t){return void 0===e[t]&&console.warn("[undefinedElementBuilder]: recorded required"),e[t].instance},c=function(t){for(var e=0;e<t.childNodes.length;e++){var n=t.childNodes[e];8!==n.nodeType&&(3!==n.nodeType||/\S/.test(n.nodeValue))?1===n.nodeType&&c(n):(t.removeChild(n),e--)}},u=function(t,e){var o=0;if(void 0!==e){if(e.attributes.length>0){for(var d=e.attributes,c=d.length-1;c>=0;c--)void 0!==n[d[c].name]?t.struct.attributes[d[c].name]=0===d[c].value.length?n[d[c].name]:r[d[c].value]:t.struct.attributes[d[c].name]=d[c].value;void 0!==t.struct.attributes.recorded&&(void 0!==t.struct.attributes.id?void 0===s(t.struct.attributes.id)&&i(t.struct.attributes.id,t):console.warn("[unrecordElementBuilder]: id required"))}t.struct.children=[],e.childNodes.forEach(function(e){3===e.nodeType?t.struct.children[o]=e.textContent:t.struct.children[o]=new v(e),e.childNodes.length>0&&u(t.struct.children[o],t.struct.children[o].node),o++})}},l=function(t,e){if(Array.isArray(t)){for(var n=[],r=0;r<t.length;r++)void 0!==t[r].node&&n.push(t[r]);e.apply(null,n)}else void 0!==t.node&&e(t)},h=function(t){return"string"==typeof t||"number"==typeof t?document.createTextNode(t):t.node},a=function(t,e){l(t,function(t){for(var n=0;n<e.length;n++)t.node.appendChild(h(e[n]))}),t.struct.children=e},f=function(t,e){l([t,e],function(t,e){void 0===t.node||void 0===e||(t.node=e.node)}),e.setAttributes(t.struct.attributes),e.setStyles(t.struct.styles),e.setChildren(t.struct.children),Object.keys(t.struct.events).length>0&&Object.keys(t.struct.events).forEach(function(n){e.setEvent(n,function(e,r){t.struct.events[n](e,r)})})},$=function(t,e){for(var n=!1,r=0,i=0;i<e.length;i++){if(JSON.stringify(e[i])===JSON.stringify(t.struct.children[0])&&i>0){n=!0,r=i;break}if(i>=20)break}n&&t.prependChildren(e,r);for(var o=n?r:0,i=o;i<e.length;i++)void 0!==t.struct.children[i]?"object"==typeof e[i]&&"object"==typeof t.struct.children[i]?e[i].struct.selector!==t.struct.children[i].struct.selector?(l([t,e[i],t.struct.children[i]],function(t,e,n){t.node.replaceChild(e.node,n.node),n.node=e.node}),t.struct.children[i].struct=e[i].struct):f(e[i],t.struct.children[i]):JSON.stringify(e[i])!==JSON.stringify(t.struct.children[i])&&(l(t,function(t){t.node.replaceChild(h(e[i]),t.node.childNodes[i])}),t.struct.children[i]=e[i]):t.appendChildren(e[i]);for(var i=t.struct.children.length-1;i>=e.length;i--)l([t,t.struct.children[i]],function(t,e){t.node.removeChild(e.node)}),t.struct.children.pop()};function v(t){RegExp("<StructOnly>").test(t)||(this.node=void 0!==t.nodeType?t:"fragment"===t?document.createDocumentFragment():document.createElement(t)),this.struct={selector:void 0!==t.nodeType?t.tagName.toLowerCase():RegExp("<StructOnly>").test(t)?t.split("<StructOnly>")[0]:t,attributes:{},styles:{},events:{},children:[]},void 0!==t.nodeType&&(c(this.node),u(this,this.node)),Object.seal(this),Object.seal(this.struct)}v.prototype.setChildren=function(){var t=arguments,e=function(){if(t.length>1){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e}return Array.isArray(t[0])?t[0]:[t[0]]}();return this.struct.children.length>0?$(this,e):a(this,e),this},v.prototype.prependChildren=function(t,e){if("string"==typeof t||"number"==typeof t)l(this,function(e){e.node.childNodes[0].insertAdjacentElement("beforebegin",document.createTextNode(t))}),this.struct.children.unshift(t);else{var n=t;void 0===t.length&&(n=[t]);for(var r=void 0===e?n.length-1:e-1,i=r;i>=0;i--)l(this,function(t){"string"==typeof n[i]||"number"==typeof n[i]?t.node.childNodes[0].insertAdjacentText("beforebegin",n[i]):t.node.childNodes[0].insertAdjacentElement("beforebegin",h(n[i]))}),this.struct.children.unshift(n[i])}return this},v.prototype.appendChildren=function(t){if("string"==typeof t||"number"==typeof t)l(this,function(e){e.node.appendChild(document.createTextNode(t))}),this.struct.children.push(t);else{var e=t;void 0===t.length&&(e=[t]);for(var n=0;n<e.length;n++)l(this,function(t){t.node.appendChild(h(e[n]))}),this.struct.children.push(e[n])}return this},v.prototype.setAttributes=function(t){var e=this;return void 0!==t.recorded&&(void 0!==t.id?void 0===s(t.id)&&i(t.id,e):console.warn("[unrecordElementBuilder]: id required")),Object.keys(t).forEach(function(n){t[n]!==e.struct.attributes[n]&&(l(e,function(e){"boolean"==typeof t[n]&&!1===t[n]?"value"===n?e.node.value="":e.node.removeProperty?e.node.removeProperty(n):e.node.removeAttribute(n):("value"===n&&(e.node.value=t[n]),e.node.setAttribute(n,t[n]))}),e.struct.attributes[n]=t[n])}),this},v.prototype.setStyles=function(t){var e=this;return Object.keys(t).forEach(function(n){t[n]!==e.struct.styles[n]&&(l(e,function(e){"boolean"==typeof t[n]&&!1===t[n]?e.node.style[n]=null:e.node.style[n]=t[n]}),e.struct.styles[n]=t[n])}),this},v.prototype.setEvent=function(t,e){var n=this;return l(this,function(n){n.node["on"+t]=function(t){e(t,n)}}),this.struct.events[t]=function(t){e(t,n)},this},v.prototype.onViewport=function(){return this.node.getBoundingClientRect().bottom-this.node.clientHeight<=(window.innerHeight||document.documentElement.clientHeight)},t.ElementBuilder=v,t.ElementFuture=function t(e){var n,r=void 0!==e.loader?e.loader():new v("div"),d=r.struct.selector,c=void 0!==e.thresholds?e.thresholds:0,u={backgroundColor:"#a30000",color:"#ffd485"};if(void 0===e.id||void 0===e.builder)return new v(d).setChildren(new v("i").setStyles(u).setChildren("[Fallback]: id and builder required"));void 0===s(e.id)&&i(e.id,new v(d).setAttributes({id:e.id,recorded:!0}));var l=s(e.id).instance;return d!==l.struct.selector&&console.warn("[InconsistentSelector]: `loader` uses `"+d+"`, but `builder` uses `"+l.struct.selector+"`"),0===s(e.id).iteration&&(r.struct.children.length>0&&l.setChildren(r.struct.children),e.builder(function t(r=function(){}){try{n=r()}catch(i){n=void 0!==e.catcher?e.catcher({name:i.name,message:i.message,styles:u}):new v(d).setChildren(new v("i").setStyles(u).setChildren("["+i.name+"]: "+i.message))}null!==l.node.parentNode&&(n.setAttributes(l.struct.attributes),l.node.parentNode.replaceChild(n.node,l.node),l.node=n.node,l.struct.selector=n.struct.selector,l.setAttributes(n.struct.attributes),l.setStyles(n.struct.styles),l.setChildren(n.struct.children),Object.keys(n.struct.events).length>0&&Object.keys(n.struct.events).forEach(function(t){l.setEvent(t,function(e,r){n.struct.events[t](e,r)})}))})),o(e.id,function(t){t.iteration++}),s(e.id).iteration===c&&o(e.id,function(t){t.iteration=0}),l},t.getElementBuilderById=d,t.document.getElementBuilderById=d}(window);