/**
 * @license JS+ (DOM) v1.0.0
 * jsplus/element-builder.js
 *
 * Copyright (c) dimaspandu
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ !function(b){"use strict";var d={},e={autofocus:!0,disabled:!0,selected:!0,multiple:!0,recorded:!0},f={"0":!1,"1":!0,false:!1,true:!0},g=function(a,b){d[a]={instance:b,iteration:0}},h=function(a,b){b(d[a])},i=function(a){return d[a]},c=function(a){return void 0===d[a]&&console.warn("[undefinedElementBuilder]: recorded required"),d[a].instance},j=function(c){for(var b=0;b<c.childNodes.length;b++){var a=c.childNodes[b];8!==a.nodeType&&(3!==a.nodeType||/\S/.test(a.nodeValue))?1===a.nodeType&&j(a):(c.removeChild(a),b--)}},k=function(c,h){var j=0;if(void 0!==h){if(h.attributes.length>0){for(var d=h.attributes,b=d.length-1;b>=0;b--)void 0!==e[d[b].name]?c.struct.attributes[d[b].name]=0===d[b].value.length?e[d[b].name]:f[d[b].value]:c.struct.attributes[d[b].name]=d[b].value;void 0!==c.struct.attributes.recorded&&(void 0!==c.struct.attributes.id?void 0===i(c.struct.attributes.id)&&g(c.struct.attributes.id,c):console.warn("[unrecordElementBuilder]: id required"))}c.struct.children=[],h.childNodes.forEach(function(b){3===b.nodeType?c.struct.children[j]=b.textContent:c.struct.children[j]=new a(b),b.childNodes.length>0&&k(c.struct.children[j],c.struct.children[j].node),j++})}},l=function(a,c){if(Array.isArray(a)){for(var d=[],b=0;b<a.length;b++)void 0!==a[b].node&&d.push(a[b]);c.apply(null,d)}else void 0!==a.node&&c(a)},m=function(a){return"string"==typeof a||"number"==typeof a?document.createTextNode(a):a.node},n=function(a,b){l(a,function(c){for(var a=0;a<b.length;a++)c.node.appendChild(m(b[a]))}),a.struct.children=b},o=function(a,b){l([a,b],function(a,b){void 0===a.node|| void 0===b||(a.node=b.node)}),b.setAttributes(a.struct.attributes),b.setStyles(a.struct.styles),b.setChildren(a.struct.children),Object.keys(a.struct.events).length>0&&Object.keys(a.struct.events).forEach(function(c){b.setEvent(c,function(b,d){a.struct.events[c](b,d)})})},p=function(b,c){for(var d=!1,e=0,a=0;a<c.length;a++){if(JSON.stringify(c[a])===JSON.stringify(b.struct.children[0])&&a>0){d=!0,e=a;break}if(a>=20)break}d&&b.prependChildren(c,e);for(var f=d?e:0,a=f;a<c.length;a++)void 0!==b.struct.children[a]?"object"==typeof c[a]&&"object"==typeof b.struct.children[a]?c[a].struct.selector!==b.struct.children[a].struct.selector?(l([b,c[a],b.struct.children[a]],function(c,a,b){c.node.replaceChild(a.node,b.node),b.node=a.node}),b.struct.children[a].struct=c[a].struct):o(c[a],b.struct.children[a]):JSON.stringify(c[a])!==JSON.stringify(b.struct.children[a])&&(l(b,function(b){b.node.replaceChild(m(c[a]),b.node.childNodes[a])}),b.struct.children[a]=c[a]):b.appendChildren(c[a]);for(var a=b.struct.children.length-1;a>=c.length;a--)l([b,b.struct.children[a]],function(a,b){a.node.removeChild(b.node)}),b.struct.children.pop()};function a(a){new RegExp("<StructOnly>").test(a)||(this.node=void 0!==a.nodeType?a:"fragment"===a?document.createDocumentFragment():document.createElement(a)),this.struct={selector:void 0!==a.nodeType?a.tagName.toLowerCase():new RegExp("<StructOnly>").test(a)?a.split("<StructOnly>")[0]:a,attributes:{},styles:{},events:{},children:[]},void 0!==a.nodeType&&(j(this.node),k(this,this.node)),Object.seal(this),Object.seal(this.struct)}a.prototype.setChildren=function(){var b=arguments,a=function(){if(b.length>1){for(var c=[],a=0;a<b.length;a++)c.push(b[a]);return c}return Array.isArray(b[0])?b[0]:[b[0]]}();return this.struct.children.length>0?p(this,a):n(this,a),this},a.prototype.prependChildren=function(a,d){if("string"==typeof a||"number"==typeof a)l(this,function(b){b.node.childNodes[0].insertAdjacentElement("beforebegin",document.createTextNode(a))}),this.struct.children.unshift(a);else{var b=a;void 0===a.length&&(b=[a]);for(var e=void 0===d?b.length-1:d-1,c=e;c>=0;c--)l(this,function(a){"string"==typeof b[c]||"number"==typeof b[c]?a.node.childNodes[0].insertAdjacentText("beforebegin",b[c]):a.node.childNodes[0].insertAdjacentElement("beforebegin",m(b[c]))}),this.struct.children.unshift(b[c])}return this},a.prototype.appendChildren=function(a){if("string"==typeof a||"number"==typeof a)l(this,function(b){b.node.appendChild(document.createTextNode(a))}),this.struct.children.push(a);else{var b=a;void 0===a.length&&(b=[a]);for(var c=0;c<b.length;c++)l(this,function(a){a.node.appendChild(m(b[c]))}),this.struct.children.push(b[c])}return this},a.prototype.setAttributes=function(a){var b=this;return void 0!==a.recorded&&(void 0!==a.id?void 0===i(a.id)&&g(a.id,b):console.warn("[unrecordElementBuilder]: id required")),Object.keys(a).forEach(function(c){a[c]!==b.struct.attributes[c]&&(l(b,function(b){"boolean"==typeof a[c]&& !1===a[c]?"value"===c?b.node.value="":b.node.removeProperty?b.node.removeProperty(c):b.node.removeAttribute(c):("value"===c&&(b.node.value=a[c]),b.node.setAttribute(c,a[c]))}),b.struct.attributes[c]=a[c])}),this},a.prototype.setStyles=function(a){var b=this;return Object.keys(a).forEach(function(c){a[c]!==b.struct.styles[c]&&(l(b,function(b){"boolean"==typeof a[c]&& !1===a[c]?b.node.style[c]=null:b.node.style[c]=a[c]}),b.struct.styles[c]=a[c])}),this},a.prototype.setEvent=function(a,b){var c=this;return l(this,function(c){c.node["on"+a]=function(a){b(a,c)}}),this.struct.events[a]=function(a){b(a,c)},this},b.ElementBuilder=a,b.ElementFuture=function(b){var k,e=void 0!==b.loader?b.loader():new a("div"),c=e.struct.selector,f=void 0!==b.thresholds?b.thresholds:0,j={backgroundColor:"#a30000",color:"#ffd485"};if(void 0===b.id|| void 0===b.builder)return new a(c).setChildren(new a("i").setStyles(j).setChildren("[Fallback]: id and builder required"));void 0===i(b.id)&&g(b.id,new a(c).setAttributes({id:b.id,recorded:!0}));var d=i(b.id).instance;return c!==d.struct.selector&&console.warn("[InconsistentSelector]: `loader` uses `"+c+"`, but `builder` uses `"+d.struct.selector+"`"),0===i(b.id).iteration&&(e.struct.children.length>0&&d.setChildren(e.struct.children),b.builder(function(f=function(){}){try{k=f()}catch(e){k=void 0!==b.catcher?b.catcher({name:e.name,message:e.message,styles:j}):new a(c).setChildren(new a("i").setStyles(j).setChildren("["+e.name+"]: "+e.message))}null!==d.node.parentNode&&(k.setAttributes(d.struct.attributes),d.node.parentNode.replaceChild(k.node,d.node),d.node=k.node,d.struct.selector=k.struct.selector,d.setAttributes(k.struct.attributes),d.setStyles(k.struct.styles),d.setChildren(k.struct.children),Object.keys(k.struct.events).length>0&&Object.keys(k.struct.events).forEach(function(a){d.setEvent(a,function(b,c){k.struct.events[a](b,c)})}))})),h(b.id,function(a){a.iteration++}),i(b.id).iteration===f&&h(b.id,function(a){a.iteration=0}),d},b.getElementBuilderById=c,b.document.getElementBuilderById=c}(window)