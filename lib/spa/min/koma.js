/**
 * @license JS+ (SPA) v1.0.0
 * jsplus/koma.js
 *
 * Copyright (c) dimaspandu
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
*/ !function(t){"use strict";var e=function(t){0===t.delay?t.set():setTimeout(t.set,t.delay)},i=function(e,i,r,a){var o=e.options.hashtag?t.location.pathname+"#":e.options.baseUrl+"";"push"===i?t.history.pushState({origin:r,request:a},null,o+a):"replace"===i?t.history.replaceState({origin:r,request:a},null,o+a):t.history.pushState({origin:r,request:a},null,o+a)},r=function(t,e){var i="function"==typeof t.pipe[e].context.container?t.pipe[e].context.container():t.pipe[e].context.container,r=t.options.hostdom;if(null!==i){for(;r.firstChild;)r.removeChild(r.firstChild);r.appendChild(void 0===i.nodeType?document.createTextNode(i.toString()):i)}},a=function(t,a,o,s,n){a.params=s,a.query=n,t.pipe[o].context=a,t.pipe[o].builder(a),t.state.firstReactor.origin=o,t.state.firstReactor.request=t.originPath(),t.state.firstReactor.params=s,t.state.firstReactor.query=n,t.state.activeReactor.origin=o,t.state.activeReactor.request=t.originPath(),t.state.activeReactor.params=s,t.state.activeReactor.query=n,t.state.journey.push({origin:o,request:t.originPath(),method:"push",params:s,query:n}),t.pipe[o].context.builder.flushTransform=function(){r(t,o)},i(t,"replace",o,t.originPath()),t.pipe[o].context.builder.waiting||t.pipe[o].context.builder.flushTransform(),t.pipe[o].context.builder.eventTransform=function(){t.notifier.meet(),e(t.pipe[o].context.onMeet),t.notifier.arrive(),e(t.pipe[o].context.onArrive)},t.pipe[o].context.builder.waiting||t.pipe[o].context.builder.eventTransform()},o=function(t,i,a,o,n,c){if("*"===a&&void 0===t.pipe["*"])return console.error("Handler not found, there is no {koma.err(callback)} pipe cause Koma in hurry."),0;if(null===t.pipe[a].context){var p=new s;p.params=n,p.query=c,t.pipe[a].context=p,t.pipe[a].builder(p)}else t.pipe[a].context.params=n,t.pipe[a].context.query=c;if(a===t.state.activeReactor.origin||(t.pipe[a].context.builder.flushTransform=function(){r(t,a)},t.pipe[a].context.builder.waiting||t.pipe[a].context.builder.flushTransform()),"replace"!==i&&(t.state.previousReactor.origin=t.state.activeReactor.origin,t.state.previousReactor.request=t.state.activeReactor.request,t.state.previousReactor.params=t.state.activeReactor.params,t.state.previousReactor.query=t.state.activeReactor.query),t.state.activeReactor.origin=a,t.state.activeReactor.request=o,t.state.activeReactor.params=n,t.state.activeReactor.query=c,"replace"===i){var u=t.state.journey.length-1;t.state.journey[u].origin=a,t.state.journey[u].request=o,t.state.journey[u].method=i,t.state.journey[u].params=n,t.state.journey[u].query=c}else t.state.journey.push({origin:a,request:o,method:i,params:n,query:c});t.pipe[a].context.builder.eventTransform=function(){t.notifier.meet(),e(t.pipe[a].context.onMeet),t.notifier.arrive(),e(t.pipe[a].context.onArrive),"*"!==a&&null===t.pipe[a].context.container&&(void 0===t.pipe[a].catcher?t.options.hostdom.innerHTML='<div style="height: 100vh; padding: 20px; width: 100%;"><h1 style="font-size: 5rem; line-height: 1;">Blank Screen</h1><p style="color: #585858; font-size: 2rem; margin-top: 8px;">No reactor catcher.</p><span style="color: #11a3c4; display: block; font-size: 2rem; font-weight: bold; margin-top: 8px; text-decoration: underline;" onclick="window.history.back();">BACK</span></div>':(t.pipe[a].catcher(t.pipe[a].context),r(t,a)))},t.pipe[a].context.builder.waiting||t.pipe[a].context.builder.eventTransform()};function s(){this.params={},this.query={},this.container=null,this.builder=Object.seal({waiting:!1,flushTransform:function(){},eventTransform:function(){},future:function(t){this.waiting=!0;var e=this;t(function t(i=function(){}){e.waiting=!1,i(),e.flushTransform(),e.eventTransform()})}}),this.onMeet=Object.seal({delay:0,set:function(){}}),this.onArrive=Object.seal({delay:0,set:function(){}}),this.onExit=Object.seal({delay:0,set:function(){}}),this.onComeback=Object.seal({delay:0,set:function(){}}),Object.seal(this)}function n(t={baseUrl:"",dividerPath:"#",hashtag:!0,hostdom:document.body}){this.options=Object.seal({baseUrl:void 0===t.baseUrl?"":"/"===t.baseUrl[t.baseUrl.length-1]?t.baseUrl.slice(0,-1):t.baseUrl,dividerPath:void 0===t.dividerPath?"#":t.dividerPath,hashtag:void 0===t.hashtag||t.hashtag,hostdom:void 0===t.hostdom?document.body:t.hostdom}),this.options.hashtag||0!==this.options.baseUrl.length||console.error("There is no {baseUrl} set in instance of koma arguments options while disabling hashtag options."),!this.options.hashtag&&this.options.baseUrl.length>0&&("#"!==this.options.dividerPath&&this.options.dividerPath!==this.options.baseUrl&&console.warn("Please set {dividerPath} same as {baseUrl} while disabling hashtag options."),this.options.dividerPath=this.options.baseUrl),Object.freeze(this)}n.prototype.requestPath=function(){return void 0!==t.location.href.split(this.options.dividerPath)[1]?t.location.href.split(this.options.dividerPath)[1]:t.location.href.split(this.options.dividerPath)[0]},n.prototype.originPath=function(){var e=-1===this.requestPath().indexOf("?")?this.requestPath():this.requestPath().split("?")[0];return e.length===t.location.href.length&&(e="/"),e},n.prototype.pipe={},n.prototype.pipeCache={},n.prototype.state=Object.seal({firstReactor:Object.seal({origin:null,request:null,params:{},query:{}}),previousReactor:Object.seal({origin:null,request:null,params:{},query:{}}),activeReactor:Object.seal({origin:null,request:null,params:{},query:{}}),journey:[],navigateBlocker:{queue:0,works:!1}}),n.prototype.notifier=Object.seal({transition:function(){},meet:function(){},arrive:function(){},exit:function(){},comeback:function(){}}),n.prototype.reactor=function(t,e,i){return this.pipe[t]={context:null,builder:e,catcher:i},this},n.prototype.err=function(t,e){return this.pipe["*"]={context:null,builder:t,catcher:e},this},n.prototype.navigator=function(t,e,i){var r=t,a={},o={};if(-1!==t.indexOf("?")){var s=t.split("?")[1].split("&");Object.keys(s).forEach(function(t){var e=s[t].split("=");o[e[0]]=e[1]}),r=t.split("?")[0]}if(void 0!==this.pipe[r])e(r,a,o),this.pipeCache[t]={originPath:r,params:a,query:o};else{var n=r.split("/"),c={exists:!1,origin:r};for(var p in this.pipe){var u=p.split("/"),h=u.length,l=n.length;if(-1!==p.indexOf("{")&&h===l)for(var v=0;v<h;v++){if(void 0!==u[v].split("{")[1])a[u[v].split("{")[1].slice(0,-1)]=n[v];else if(u[v]===n[v])c.exists=!0,c.origin=p;else{c.exists=!1;break}if(v===h-1&&c.exists)break}if(c.exists)break}c.exists?(e(c.origin,a,o),this.pipeCache[t]={originPath:c.origin,params:a,query:o}):(i(),this.pipeCache[t]={originPath:"*",params:a,query:o})}},n.prototype.navigateProcess=function(t,e="push"){var r=this;void 0!==this.pipeCache[t]?(i(r,e,this.pipeCache[t].originPath,t),o(r,e,this.pipeCache[t].originPath,t,this.pipeCache[t].params,this.pipeCache[t].query)):this.navigator(t,function(a,s,n){i(r,e,a,t),o(r,e,a,t,s,n)},function(){i(r,e,"*",t),o(r,e,"*",t,{},{})})},n.prototype.navigatePush=function(t){if(this.notifier.transition(),this.state.navigateBlocker.works){var e=this,i=!0,r=setInterval(function(){e.state.navigateBlocker.works||(e.navigateProcess(t,"push"),i=!1,clearInterval(r))},0);setTimeout(function(){i&&(i=!1,clearInterval(r))},1e3)}else this.navigateProcess(t,"push")},n.prototype.navigateReplace=function(t){if(this.notifier.transition(),this.state.navigateBlocker.works){var e=this,i=!0,r=setInterval(function(){e.state.navigateBlocker.works||(e.navigateProcess(t,"replace"),i=!1,clearInterval(r))},0);setTimeout(function(){i&&(i=!1,clearInterval(r))},1e3)}else this.navigateProcess(t,"replace")},n.prototype.navigateClear=function(){this.state.navigateBlocker.queue=this.state.journey.length,this.state.navigateBlocker.works=!0,this.state.firstReactor.origin=this.state.activeReactor.origin,this.state.firstReactor.request=this.state.activeReactor.request,this.state.firstReactor.params=this.state.activeReactor.params,this.state.firstReactor.query=this.state.activeReactor.query,this.state.previousReactor.origin=null,this.state.previousReactor.request=null,this.state.previousReactor.params={},this.state.previousReactor.query={};for(var e=this.state.journey.length-1;e>=1;e--)t.history.back();var i=[{origin:this.state.activeReactor.origin,request:this.state.activeReactor.request,params:this.state.activeReactor.params,query:this.state.activeReactor.query}];this.state.journey=i,this.navigateReplace(this.state.journey[0].request)},n.prototype.navigatePop=function(){var t=this,a=function(){t.state.previousReactor.origin===t.state.activeReactor.origin||(t.pipe[t.state.previousReactor.origin].context.builder.flushTransform=function(){r(t,t.state.previousReactor.origin)},t.pipe[t.state.previousReactor.origin].context.builder.waiting||t.pipe[t.state.previousReactor.origin].context.builder.flushTransform()),t.state.journey.pop(),t.state.activeReactor.origin=t.state.journey[t.state.journey.length-1].origin,t.state.activeReactor.request=t.state.journey[t.state.journey.length-1].request,t.state.activeReactor.params=t.state.journey[t.state.journey.length-1].params,t.state.activeReactor.query=t.state.journey[t.state.journey.length-1].query,t.state.previousReactor.origin=1===t.state.journey.length?null:t.state.journey[t.state.journey.length-2].origin,t.state.previousReactor.request=1===t.state.journey.length?null:t.state.journey[t.state.journey.length-2].request,t.state.previousReactor.params=1===t.state.journey.length?null:t.state.journey[t.state.journey.length-2].params,t.state.previousReactor.query=1===t.state.journey.length?null:t.state.journey[t.state.journey.length-2].query,t.pipe[t.state.activeReactor.origin].context.params=t.state.activeReactor.params,t.pipe[t.state.activeReactor.origin].context.query=t.state.activeReactor.query,t.pipe[t.state.activeReactor.origin].context.builder.eventTransform=function(){t.notifier.meet(),e(t.pipe[t.state.activeReactor.origin].context.onMeet),t.notifier.comeback(),e(t.pipe[t.state.activeReactor.origin].context.onComeback)},t.pipe[t.state.activeReactor.origin].context.builder.waiting||t.pipe[t.state.activeReactor.origin].context.builder.eventTransform()},o=this.pipe[this.state.activeReactor.origin].context.onExit,s=o.set();void 0===s||s?(t.notifier.exit(),0===o.delay?a():setTimeout(a,o.delay)):(i(this,"push",this.state.activeReactor.origin,this.state.activeReactor.request),t.pipe[t.state.activeReactor.origin].context.builder.eventTransform=function(){t.notifier.meet(),e(t.pipe[t.state.activeReactor.origin].context.onMeet),t.notifier.arrive(),e(t.pipe[t.state.activeReactor.origin].context.onArrive)},t.pipe[t.state.activeReactor.origin].context.builder.waiting||t.pipe[t.state.activeReactor.origin].context.builder.eventTransform())},n.prototype.addNotifier=function(t,e){this.notifier[t]=e},n.prototype.tap=function(){try{var e=this,i=new s;this.navigator(-1===this.requestPath().indexOf("?")?this.originPath():this.requestPath(),function(t,r,o){a(e,i,t,r,o)},function(){return void 0!==e.pipe["*"]?(a(e,i,"*",{},{}),1):(console.error("Handler not found, there is no {koma.err(callback)} pipe cause Koma in hurry."),0)}),t.onpopstate=function(i){i.preventDefault(),e.notifier.transition(),e.state.navigateBlocker.works&&(e.state.navigateBlocker.queue--,1===e.state.navigateBlocker.queue&&(e.state.navigateBlocker.works=!1)),-1===e.pipe[e.state.activeReactor.origin].context.onExit.delay?t.history.go(-1):i.state.origin===e.state.previousReactor.origin?e.navigatePop():e.state.navigateBlocker.works||o(e,"push",i.state.origin,i.state.request,null===e.pipe[i.state.origin].context?{}:e.pipe[i.state.origin].context.params,null===e.pipe[i.state.origin].context?{}:e.pipe[i.state.origin].context.query)}}catch(r){console.error("Koma reactor error:",r.message)}return this},t.Koma=n}(window);