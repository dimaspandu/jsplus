/**
 * @license JS+ (SPA) v1.0.0
 * jsplus/koma.js
 *
 * Copyright (c) dimaspandu
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */ !function(b){"use strict";var c=function(a){0===a.delay?a.set():setTimeout(a.set,a.delay)},d=function(e,f,c,a){var d=e.options.hashtag?b.location.pathname+"#":e.options.baseUrl+"";"push"===f?b.history.pushState({origin:c,request:a},null,d+a):"replace"===f?b.history.replaceState({origin:c,request:a},null,d+a):b.history.pushState({origin:c,request:a},null,d+a)},e=function(a,d){var b="function"==typeof a.pipe[d].context.container?a.pipe[d].context.container():a.pipe[d].context.container,c=a.options.hostdom;if(null!==b){for(;c.firstChild;)c.removeChild(c.firstChild);c.appendChild(void 0===b.nodeType?document.createTextNode(b.toString()):b)}},f=function(a,f,b,g,h){f.params=g,f.query=h,a.pipe[b].context=f,a.pipe[b].builder(f),a.state.firstReactor.origin=b,a.state.firstReactor.request=a.originPath(),a.state.firstReactor.params=g,a.state.firstReactor.query=h,a.state.activeReactor.origin=b,a.state.activeReactor.request=a.originPath(),a.state.activeReactor.params=g,a.state.activeReactor.query=h,a.state.journey.push({origin:b,request:a.originPath(),method:"push",params:g,query:h}),a.pipe[b].context.builder.flushTransform=function(){e(a,b)},d(a,"replace",b,a.originPath()),a.pipe[b].context.builder.waiting||a.pipe[b].context.builder.flushTransform(),a.pipe[b].context.builder.eventTransform=function(){a.notifier.meet(),c(a.pipe[b].context.onMeet),a.notifier.arrive(),c(a.pipe[b].context.onArrive)},a.pipe[b].context.builder.waiting||a.pipe[b].context.builder.eventTransform()},g=function(a,i,b,k,d,f){if("*"===b&& void 0===a.pipe["*"])return console.error("Handler not found, there is no {koma.err(callback)} pipe cause Koma in hurry."),0;if(null===a.pipe[b].context){var j=new h;j.params=d,j.query=f,a.pipe[b].context=j,a.pipe[b].builder(j)}else a.pipe[b].context.params=d,a.pipe[b].context.query=f;if(b===a.state.activeReactor.origin||(a.pipe[b].context.builder.flushTransform=function(){e(a,b)},a.pipe[b].context.builder.waiting||a.pipe[b].context.builder.flushTransform()),"replace"!==i&&(a.state.previousReactor.origin=a.state.activeReactor.origin,a.state.previousReactor.request=a.state.activeReactor.request,a.state.previousReactor.params=a.state.activeReactor.params,a.state.previousReactor.query=a.state.activeReactor.query),a.state.activeReactor.origin=b,a.state.activeReactor.request=k,a.state.activeReactor.params=d,a.state.activeReactor.query=f,"replace"===i){var g=a.state.journey.length-1;a.state.journey[g].origin=b,a.state.journey[g].request=k,a.state.journey[g].method=i,a.state.journey[g].params=d,a.state.journey[g].query=f}else a.state.journey.push({origin:b,request:k,method:i,params:d,query:f});a.pipe[b].context.builder.eventTransform=function(){a.notifier.meet(),c(a.pipe[b].context.onMeet),a.notifier.arrive(),c(a.pipe[b].context.onArrive),"*"!==b&&null===a.pipe[b].context.container&&(void 0===a.pipe[b].catcher?a.options.hostdom.innerHTML='<div style="height: 100vh; padding: 20px; width: 100%;"><h1 style="font-size: 5rem; line-height: 1;">Blank Screen</h1><p style="color: #585858; font-size: 2rem; margin-top: 8px;">No reactor catcher.</p><span style="color: #11a3c4; display: block; font-size: 2rem; font-weight: bold; margin-top: 8px; text-decoration: underline;" onclick="window.history.back();">BACK</span></div>':(a.pipe[b].catcher(a.pipe[b].context),e(a,b)))},a.pipe[b].context.builder.waiting||a.pipe[b].context.builder.eventTransform()};function h(){this.params={},this.query={},this.container=null,this.builder=Object.seal({waiting:!1,flushTransform:function(){},eventTransform:function(){},future:function(a){this.waiting=!0;var b=this;a(function(a=function(){}){b.waiting=!1,a(),b.flushTransform(),b.eventTransform()})}}),this.onMeet=Object.seal({delay:0,set:function(){}}),this.onArrive=Object.seal({delay:0,set:function(){}}),this.onExit=Object.seal({delay:0,set:function(){}}),this.onComeback=Object.seal({delay:0,set:function(){}}),Object.seal(this)}function a(a={baseUrl:"",dividerPath:"#",hashtag:!0,hostdom:document.body}){this.options=Object.seal({baseUrl:void 0===a.baseUrl?"":"/"===a.baseUrl[a.baseUrl.length-1]?a.baseUrl.slice(0,-1):a.baseUrl,dividerPath:void 0===a.dividerPath?"#":a.dividerPath,hashtag:void 0===a.hashtag||a.hashtag,hostdom:void 0===a.hostdom?document.body:a.hostdom}),this.options.hashtag||0!==this.options.baseUrl.length||console.error("There is no {baseUrl} set in instance of koma arguments options while disabling hashtag options."),!this.options.hashtag&&this.options.baseUrl.length>0&&("#"!==this.options.dividerPath&&this.options.dividerPath!==this.options.baseUrl&&console.warn("Please set {dividerPath} same as {baseUrl} while disabling hashtag options."),this.options.dividerPath=this.options.baseUrl),Object.freeze(this)}a.prototype.requestPath=function(){return void 0!==b.location.href.split(this.options.dividerPath)[1]?b.location.href.split(this.options.dividerPath)[1]:b.location.href.split(this.options.dividerPath)[0]},a.prototype.originPath=function(){var a=-1===this.requestPath().indexOf("?")?this.requestPath():this.requestPath().split("?")[0];return a.length===b.location.href.length&&(a="/"),a},a.prototype.pipe={},a.prototype.pipeCache={},a.prototype.state=Object.seal({firstReactor:Object.seal({origin:null,request:null,params:{},query:{}}),previousReactor:Object.seal({origin:null,request:null,params:{},query:{}}),activeReactor:Object.seal({origin:null,request:null,params:{},query:{}}),journey:[],navigateBlocker:{queue:0,works:!1}}),a.prototype.notifier=Object.seal({transition:function(){},meet:function(){},arrive:function(){},exit:function(){},comeback:function(){}}),a.prototype.reactor=function(a,b,c){return this.pipe[a]={context:null,builder:b,catcher:c},this},a.prototype.err=function(a,b){return this.pipe["*"]={context:null,builder:a,catcher:b},this},a.prototype.navigator=function(c,k,l){var d=c,e={},f={};if(-1!==c.indexOf("?")){var m=c.split("?")[1].split("&");Object.keys(m).forEach(function(b){var a=m[b].split("=");f[a[0]]=a[1]}),d=c.split("?")[0]}if(void 0!==this.pipe[d])k(d,e,f),this.pipeCache[c]={originPath:d,params:e,query:f};else{var h=d.split("/"),a={exists:!1,origin:d};for(var i in this.pipe){var g=i.split("/"),j=g.length,n=h.length;if(-1!==i.indexOf("{")&&j===n)for(var b=0;b<j;b++){if(void 0!==g[b].split("{")[1])e[g[b].split("{")[1].slice(0,-1)]=h[b];else if(g[b]===h[b])a.exists=!0,a.origin=i;else{a.exists=!1;break}if(b===j-1&&a.exists)break}if(a.exists)break}a.exists?(k(a.origin,e,f),this.pipeCache[c]={originPath:a.origin,params:e,query:f}):(l(),this.pipeCache[c]={originPath:"*",params:e,query:f})}},a.prototype.navigateProcess=function(a,b="push"){var c=this;void 0!==this.pipeCache[a]?(d(c,b,this.pipeCache[a].originPath,a),g(c,b,this.pipeCache[a].originPath,a,this.pipeCache[a].params,this.pipeCache[a].query)):this.navigator(a,function(e,f,h){d(c,b,e,a),g(c,b,e,a,f,h)},function(){d(c,b,"*",a),g(c,b,"*",a,{},{})})},a.prototype.navigatePush=function(a){if(this.notifier.transition(),this.state.navigateBlocker.works){var b=this,c=!0,d=setInterval(function(){b.state.navigateBlocker.works||(b.navigateProcess(a,"push"),c=!1,clearInterval(d))},0);setTimeout(function(){c&&(c=!1,clearInterval(d))},1e3)}else this.navigateProcess(a,"push")},a.prototype.navigateReplace=function(a){if(this.notifier.transition(),this.state.navigateBlocker.works){var b=this,c=!0,d=setInterval(function(){b.state.navigateBlocker.works||(b.navigateProcess(a,"replace"),c=!1,clearInterval(d))},0);setTimeout(function(){c&&(c=!1,clearInterval(d))},1e3)}else this.navigateProcess(a,"replace")},a.prototype.navigateClear=function(){this.state.navigateBlocker.queue=this.state.journey.length,this.state.navigateBlocker.works=!0,this.state.firstReactor.origin=this.state.activeReactor.origin,this.state.firstReactor.request=this.state.activeReactor.request,this.state.firstReactor.params=this.state.activeReactor.params,this.state.firstReactor.query=this.state.activeReactor.query,this.state.previousReactor.origin=null,this.state.previousReactor.request=null,this.state.previousReactor.params={},this.state.previousReactor.query={};for(var a=this.state.journey.length-1;a>=1;a--)b.history.back();var c=[{origin:this.state.activeReactor.origin,request:this.state.activeReactor.request,params:this.state.activeReactor.params,query:this.state.activeReactor.query}];this.state.journey=c,this.navigateReplace(this.state.journey[0].request)},a.prototype.navigatePop=function(){var a=this,f=function(){a.state.previousReactor.origin===a.state.activeReactor.origin||(a.pipe[a.state.previousReactor.origin].context.builder.flushTransform=function(){e(a,a.state.previousReactor.origin)},a.pipe[a.state.previousReactor.origin].context.builder.waiting||a.pipe[a.state.previousReactor.origin].context.builder.flushTransform()),a.state.journey.pop(),a.state.activeReactor.origin=a.state.journey[a.state.journey.length-1].origin,a.state.activeReactor.request=a.state.journey[a.state.journey.length-1].request,a.state.activeReactor.params=a.state.journey[a.state.journey.length-1].params,a.state.activeReactor.query=a.state.journey[a.state.journey.length-1].query,a.state.previousReactor.origin=1===a.state.journey.length?null:a.state.journey[a.state.journey.length-2].origin,a.state.previousReactor.request=1===a.state.journey.length?null:a.state.journey[a.state.journey.length-2].request,a.state.previousReactor.params=1===a.state.journey.length?null:a.state.journey[a.state.journey.length-2].params,a.state.previousReactor.query=1===a.state.journey.length?null:a.state.journey[a.state.journey.length-2].query,a.pipe[a.state.activeReactor.origin].context.params=a.state.activeReactor.params,a.pipe[a.state.activeReactor.origin].context.query=a.state.activeReactor.query,a.pipe[a.state.activeReactor.origin].context.builder.eventTransform=function(){a.notifier.meet(),c(a.pipe[a.state.activeReactor.origin].context.onMeet),a.notifier.comeback(),c(a.pipe[a.state.activeReactor.origin].context.onComeback)},a.pipe[a.state.activeReactor.origin].context.builder.waiting||a.pipe[a.state.activeReactor.origin].context.builder.eventTransform()},b=this.pipe[this.state.activeReactor.origin].context.onExit,g=b.set();void 0===g||g?(a.notifier.exit(),0===b.delay?f():setTimeout(f,b.delay)):(d(this,"push",this.state.activeReactor.origin,this.state.activeReactor.request),a.pipe[a.state.activeReactor.origin].context.builder.eventTransform=function(){a.notifier.meet(),c(a.pipe[a.state.activeReactor.origin].context.onMeet),a.notifier.arrive(),c(a.pipe[a.state.activeReactor.origin].context.onArrive)},a.pipe[a.state.activeReactor.origin].context.builder.waiting||a.pipe[a.state.activeReactor.origin].context.builder.eventTransform())},a.prototype.addNotifier=function(a,b){this.notifier[a]=b},a.prototype.tap=function(){try{var c=this,d=new h;this.navigator(-1===this.requestPath().indexOf("?")?this.originPath():this.requestPath(),function(a,b,e){f(c,d,a,b,e)},function(){if(void 0===c.pipe["*"])return console.error("Handler not found, there is no {koma.err(callback)} pipe cause Koma in hurry."),0;f(c,d,"*",{},{})}),b.onpopstate=function(a){a.preventDefault(),c.notifier.transition(),c.state.navigateBlocker.works&&(c.state.navigateBlocker.queue--,1===c.state.navigateBlocker.queue&&(c.state.navigateBlocker.works=!1)),-1===c.pipe[c.state.activeReactor.origin].context.onExit.delay?b.history.go(-1):a.state.origin===c.state.previousReactor.origin?c.navigatePop():c.state.navigateBlocker.works||g(c,"push",a.state.origin,a.state.request,null===c.pipe[a.state.origin].context?{}:c.pipe[a.state.origin].context.params,null===c.pipe[a.state.origin].context?{}:c.pipe[a.state.origin].context.query)}}catch(a){return console.error("Koma reactor error:",a.message),0}},b.Koma=a}(window)